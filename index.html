<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' plausible.io 'nonce-A132076C'; worker-src 'self' blob:; style-src 'self' 'unsafe-inline'; frame-src open.spotify.com embed.tidal.com *.youtube.com *.youtu.be *.x.com *.twitter.com; child-src 'none'; form-action 'none';" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script nonce="A132076C">
      // Migration: TODO: remove this
      const oldSessions = {}
      const newSessions = {}

      try {
        Object.assign(oldSessions, JSON.parse(localStorage["sessions"]))
      } catch (e) {
        // Pass
      }

      for (const [key, session] of Object.entries(oldSessions)) {
        const {method, privkey, secret, connectKey, connectToken, connectHandler, ...extra} =
          session

        if (method === "extension") {
          newSessions[key] = {method: "nip07", ...extra}
        } else if (method === "privkey") {
          newSessions[key] = {method: "nip01", secret: privkey, ...extra}
        } else if (method === "connect") {
          newSessions[key] = {
            ...extra,
            method: "nip46",
            secret: connectKey,
            token: connectToken,
            handler: connectHandler,
          }
        } else {
          newSessions[key] = session
        }
      }

      localStorage["sessions"] = JSON.stringify(newSessions)
    </script>
  </head>
  <body class="w-full">
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
    <script
      nonce="A132076C"
      async
      src="https://platform.twitter.com/widgets.js"
      charset="utf-8"></script>
    <script
      nonce="A132076C"
      async
      src="https://platform.twitter.com/js/tweet.d7aeb21a88e025d2ea5f5431a103f586.js"
      charset="utf-8"></script>
    <script
      defer
      data-domain="coracle.social"
      src="https://plausible.io/js/script.manual.js"></script>
  </body>
</html>
